<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Smart Library - Student</title>
<style>
  body{ font-family:Arial,Helvetica,sans-serif; margin:0; background:#f4f7fb; }
  header{ background:#0d6efd; color:#fff; padding:12px 18px; display:flex; justify-content:space-between; align-items:center;}
  header h1{ margin:0; font-size:18px; }
  .container{ max-width:1100px; margin:18px auto; padding:14px; }
  .filters{ background:#fff; padding:12px; border-radius:8px; display:flex; gap:10px; align-items:center; box-shadow:0 6px 20px rgba(0,0,0,0.04); }
  select, input{ padding:8px 10px; border-radius:6px; border:1px solid #ccc; }
  table{ width:100%; margin-top:12px; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden; box-shadow:0 6px 20px rgba(0,0,0,0.04);}
  th,td{ padding:10px; border-bottom:1px solid #eee; text-align:left; }
  th{ background:#094bb5; color:#fff; }
  .muted{ color:#555; }
  @media(max-width:720px){ .filters{flex-direction:column; align-items:stretch} }

 .footer {
      text-align: center;
      background-color: #0d47a1;
      color: white;
      padding: 15px;
      position: fixed;
      bottom: 0;
      width: 100%;
      font-size: 14px;
    }
</style>
</head>
<body>
<header>
  <h1>ðŸŽ“ Smart Library - Student Portal</h1>
  <div>
    <span id="studentName" class="muted"></span>
    <button onclick="handleLogout()" style="margin-left:10px;padding:7px 10px;border-radius:6px;border:none;background:#fff;color:#0d6efd;cursor:pointer;">Logout</button>
  </div>
</header>

<div class="container">
  <div class="filters">
    <input id="q" placeholder="Search by title/author..." style="flex:1;">
    <select id="filterBranch">
      <option value="">All Branches</option>
      <option>Computer Science and Engineering</option>
      <option>Electrical Engineering</option>
      <option>Electronics Engineering</option>
      <option>Civil Engineering</option>
      <option>Mechanical Engineering</option>
    </select>
    <select id="filterSemester">
      <option value="">All Semesters</option>
      <option>1st Semester</option>
      <option>2nd Semester</option>
      <option>3rd Semester</option>
      <option>4th Semester</option>
      <option>5th Semester</option>
      <option>6th Semester</option>
    </select>
    <button onclick="applyFilters()" style="background:#0d6efd;color:#fff;padding:8px 12px;border-radius:6px;border:none;cursor:pointer;">Filter</button>
    <button onclick="resetFilters()" style="background:#6c757d;color:#fff;padding:8px 12px;border-radius:6px;border:none;cursor:pointer;">Reset</button>
  </div>

  <table id="booksTbl">
    <thead>
      <tr><th>Book ID</th><th>Title</th><th>Author</th><th>Branch</th><th>Semester</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>
  <footer>
    Â© 2025 Smart Library | Book Issue System by coding brothers
  </footer>
<script>
const BOOKS_KEY = 'sl_books';
const CUR_USER = 'sl_currentUser';

function requireLogin(){
  const cur = JSON.parse(localStorage.getItem(CUR_USER));
  if (!cur) { alert('Login required'); window.location.href='frontend02.html'; return null; }
  document.getElementById('studentName').textContent = (cur.fullName || cur.username) + ' (' + (cur.role||'') + ')';
  return cur;
}
const curUser = requireLogin();
if (!curUser) throw new Error('login required');

let books = JSON.parse(localStorage.getItem(BOOKS_KEY)) || [];
function renderBooks(list){
  const tbody = document.querySelector('#booksTbl tbody');
  tbody.innerHTML = '';
  (list||books).forEach(b=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${b.id}</td><td>${escapeHtml(b.name)}</td><td>${escapeHtml(b.author)}</td><td>${escapeHtml(b.branch)}</td><td>${escapeHtml(b.semester)}</td>`;
    tbody.appendChild(tr);
  });
}
function escapeHtml(s){ return (s||'').toString().replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

function applyFilters(){
  const q = (document.getElementById('q').value||'').toLowerCase();
  const branch = document.getElementById('filterBranch').value;
  const semester = document.getElementById('filterSemester').value;
  let res = books.filter(b=>{
    if (branch && b.branch!==branch) return false;
    if (semester && b.semester!==semester) return false;
    if (q){
      const hay = (b.name+' '+b.author+' '+b.branch+' '+b.semester).toLowerCase();
      return hay.includes(q);
    }
    return true;
  });
  renderBooks(res);
}
function resetFilters(){ document.getElementById('q').value=''; document.getElementById('filterBranch').value=''; document.getElementById('filterSemester').value=''; renderBooks(books); }

function handleLogout(){ localStorage.removeItem(CUR_USER); window.location.href='frontend02.html'; }

// initial
renderBooks();
</script>
</body>
</html>